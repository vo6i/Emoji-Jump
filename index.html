<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emoji Jump!</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts (Inter) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <!-- React and ReactDOM CDNs -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        /* Custom styles for the game area to ensure positioning works correctly */
        #game-root {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            background: linear-gradient(to bottom right, #e0f2fe, #c5e0ff); /* Adjusted gradient */
        }
        .phone-container {
            position: relative; /* Ensure children are positioned relative to this */
            width: 100%;
            max-width: 64rem; /* Equivalent to max-w-4xl */
            height: 24rem; /* Equivalent to h-96 */
            background-color: white;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* shadow-xl */
            overflow: hidden;
            border: 4px solid #d1d5db; /* border-4 border-gray-300 */
        }
        .phone-item {
            position: absolute;
            transform: translate(-50%, -50%); /* Center the phone on its x,y coordinates */
            width: 120px;
            height: 180px;
            min-width: 100px;
            min-height: 150px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            font-family: 'Inter', sans-serif;
            z-index: 1;
        }
        .phone-item.is-current {
            border: 4px solid #3b82f6; /* border-4 border-blue-500 */
            background-color: #e0f2fe; /* bg-gray-200 */
            box-shadow: 0 0 15px rgba(0, 123, 255, 0.7);
            z-index: 5;
        }
        .emoji-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: yellow;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 28px;
            border: 2px solid #333;
            z-index: 10;
        }
        .emoji-icon.is-current-emoji {
            transform: scale(1.25) translateY(-1rem); /* scale-125 -translate-y-4 */
        }
    </style>
</head>
<body>
    <div id="game-root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;
        const { createRoot } = ReactDOM;

        // Main App Component
        const App = () => {
            // Game States
            const GAME_STATE = {
                START: 'start',
                PLAYING: 'playing',
                GAME_OVER: 'gameOver',
            };

            // State variables
            const [gameState, setGameState] = useState(GAME_STATE.START);
            const [score, setScore] = useState(0);
            const [currentPhoneId, setCurrentPhoneId] = useState(null); // ID —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –≤ –∫–æ—Ç–æ—Ä–æ–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å–º–∞–π–ª–∏–∫
            const [phones, setPhones] = useState([]); // –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤
            const [message, setMessage] = useState(''); // –ò–≥—Ä–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
            const [jumpCooldown, setJumpCooldown] = useState(0); // –ö—É–ª–¥–∞—É–Ω –¥–ª—è –ø—Ä—ã–∂–∫–∞
            const [timeToNextPhone, setTimeToNextPhone] = useState(5); // –í—Ä–µ–º—è –¥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏–ª–∏ –∫–æ–Ω—Ü–∞ –∏–≥—Ä—ã
            const [phoneSpawnInterval, setPhoneSpawnInterval] = useState(2000); // –ö–∞–∫ —á–∞—Å—Ç–æ –ø–æ—è–≤–ª—è—é—Ç—Å—è –Ω–æ–≤—ã–µ —Ç–µ–ª–µ—Ñ–æ–Ω—ã (–º—Å)
            const [phoneDisappearTime, setPhoneDisappearTime] = useState(3000); // –ö–∞–∫ –¥–æ–ª–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω—ã –æ—Å—Ç–∞—é—Ç—Å—è –≤–∏–¥–∏–º—ã–º–∏ (–º—Å)

            // Refs for intervals/timeouts
            const gameLoopIntervalRef = useRef(null);
            const phoneSpawnIntervalRef = useRef(null);
            const phoneDisappearTimeoutRef = useRef({}); // –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–æ–≤ –¥–ª—è –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω–∞

            // Game settings
            const MAX_PHONES = 3; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–∏–º—ã—Ö —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
            const JUMP_COOLDOWN_TIME = 0.5; // –°–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –ø—Ä—ã–∂–∫–∞–º–∏
            const INITIAL_TIME_TO_NEXT_PHONE = 5; // –ù–∞—á–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á–µ—Ç–∞ –¥–æ –∫–æ–Ω—Ü–∞ –∏–≥—Ä—ã

            // Utility function to generate unique IDs
            const generateId = useCallback(() => Math.random().toString(36).substr(2, 9), []);

            // --- Game Logic Functions ---

            // –ù–∞—á–∏–Ω–∞–µ—Ç –∏–≥—Ä—É
            const startGame = useCallback(() => {
                setScore(0);
                setPhones([]);
                setMessage('');
                setCurrentPhoneId(null);
                setJumpCooldown(0);
                setTimeToNextPhone(INITIAL_TIME_TO_NEXT_PHONE);
                setGameState(GAME_STATE.PLAYING);

                // –ò–∑–Ω–∞—á–∞–ª—å–Ω—ã–π —Å–ø–∞–≤–Ω —Ç–µ–ª–µ—Ñ–æ–Ω–∞
                const initialPhoneId = generateId();
                setPhones([{ id: initialPhoneId, x: 50, y: 50, isCurrent: true }]);
                setCurrentPhoneId(initialPhoneId);
            }, [GAME_STATE.PLAYING, generateId, INITIAL_TIME_TO_NEXT_PHONE]);

            // –ó–∞–≤–µ—Ä—à–∞–µ—Ç –∏–≥—Ä—É
            const endGame = useCallback((reason) => {
                setMessage(`–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! ${reason}. –°—á–µ—Ç: ${score}`);
                setGameState(GAME_STATE.GAME_OVER);
                clearInterval(gameLoopIntervalRef.current);
                clearInterval(phoneSpawnIntervalRef.current);
                // –û—á–∏—â–∞–µ–º –≤—Å–µ —Ç–∞–π–º–∞—É—Ç—ã –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤
                Object.values(phoneDisappearTimeoutRef.current).forEach(clearTimeout);
                phoneDisappearTimeoutRef.current = {};
            }, [score, GAME_STATE.GAME_OVER]);

            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä—ã–∂–æ–∫ —Å–º–∞–π–ª–∏–∫–∞ –Ω–∞ –Ω–æ–≤—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω
            const handleJump = useCallback((targetPhoneId) => {
                if (gameState !== GAME_STATE.PLAYING || jumpCooldown > 0) return;

                const targetPhone = phones.find(p => p.id === targetPhoneId);

                if (targetPhone && targetPhone.id !== currentPhoneId) {
                    setScore(prevScore => prevScore + 1);
                    setMessage('–£—Å–ø–µ—à–Ω—ã–π –ø—Ä—ã–∂–æ–∫!');

                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π —Ç–µ–ª–µ—Ñ–æ–Ω
                    setPhones(prevPhones => prevPhones.map(p => ({
                        ...p,
                        isCurrent: p.id === targetPhoneId
                    })));
                    setCurrentPhoneId(targetPhoneId);

                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω–∞/–∫–æ–Ω—Ü–∞ –∏–≥—Ä—ã
                    setTimeToNextPhone(INITIAL_TIME_TO_NEXT_PHONE);

                    // –û—á–∏—â–∞–µ–º —Ç–∞–π–º–∞—É—Ç –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ç–µ–∫—É—â–µ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
                    if (phoneDisappearTimeoutRef.current[targetPhoneId]) {
                        clearTimeout(phoneDisappearTimeoutRef.current[targetPhoneId]);
                        delete phoneDisappearTimeoutRef.current[targetPhoneId];
                    }

                    setJumpCooldown(JUMP_COOLDOWN_TIME); // –ó–∞–ø—É—Å–∫–∞–µ–º –∫—É–ª–¥–∞—É–Ω
                } else if (targetPhone && targetPhone.id === currentPhoneId) {
                    setMessage("–£–∂–µ –≤ —ç—Ç–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–µ!");
                } else {
                    setMessage("–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –ø—Ä—ã–∂–∫–∞!");
                }
            }, [gameState, jumpCooldown, phones, currentPhoneId, GAME_STATE.PLAYING, INITIAL_TIME_TO_NEXT_PHONE]);

            // –°–ø–∞–≤–Ω–∏—Ç –Ω–æ–≤—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω
            const spawnPhone = useCallback(() => {
                setPhones(prevPhones => {
                    // –£–¥–∞–ª—è–µ–º —Å–∞–º—ã–π —Å—Ç–∞—Ä—ã–π –Ω–µ-—Ç–µ–∫—É—â–∏–π —Ç–µ–ª–µ—Ñ–æ–Ω, –µ—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –º–∞–∫—Å–∏–º—É–º
                    if (prevPhones.length >= MAX_PHONES) {
                        const nonCurrentPhones = prevPhones.filter(p => !p.isCurrent);
                        if (nonCurrentPhones.length > 0) {
                            const oldestNonCurrentId = nonCurrentPhones[0].id;
                            // –û—á–∏—â–∞–µ–º –µ–≥–æ —Ç–∞–π–º–∞—É—Ç –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è, –µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                            if (phoneDisappearTimeoutRef.current[oldestNonCurrentId]) {
                                clearTimeout(phoneDisappearTimeoutRef.current[oldestNonCurrentId]);
                                delete phoneDisappearTimeoutRef.current[oldestNonCurrentId];
                            }
                            return prevPhones.filter(p => p.id !== oldestNonCurrentId);
                        }
                    }

                    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
                    const newX = Math.random() * 80 + 10; // –û—Ç 10% –¥–æ 90% —à–∏—Ä–∏–Ω—ã
                    const newY = Math.random() * 80 + 10; // –û—Ç 10% –¥–æ 90% –≤—ã—Å–æ—Ç—ã
                    const newPhone = { id: generateId(), x: newX, y: newY, isCurrent: false };

                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–∞—É—Ç –¥–ª—è –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –µ—Å–ª–∏ –Ω–∞ –Ω–µ–≥–æ –Ω–µ –ø—Ä—ã–≥–Ω—É–ª–∏
                    phoneDisappearTimeoutRef.current[newPhone.id] = setTimeout(() => {
                        setPhones(current => {
                            // –£–¥–∞–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ —Ç–µ–∫—É—â–∏–π —Ç–µ–ª–µ—Ñ–æ–Ω
                            if (current.find(p => p.id === newPhone.id && p.isCurrent)) {
                                return current; // –ù–µ —É–¥–∞–ª—è–µ–º, –µ—Å–ª–∏ –æ–Ω —Å—Ç–∞–ª —Ç–µ–∫—É—â–∏–º
                            }
                            return current.filter(p => p.id !== newPhone.id);
                        });
                        delete phoneDisappearTimeoutRef.current[newPhone.id];
                    }, phoneDisappearTime);

                    return [...prevPhones, newPhone];
                });
            }, [generateId, MAX_PHONES, phoneDisappearTime]);

            // --- Effects ---

            // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª (–¢–∞–π–º–µ—Ä –¥–æ –∫–æ–Ω—Ü–∞ –∏–≥—Ä—ã)
            useEffect(() => {
                if (gameState === GAME_STATE.PLAYING) {
                    gameLoopIntervalRef.current = setInterval(() => {
                        setTimeToNextPhone(prevTime => {
                            if (prevTime <= 0) {
                                endGame("–í—Ä–µ–º—è –≤—ã—à–ª–æ! –ù–µ—Ç –Ω–æ–≤–æ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –ø—Ä—ã–∂–∫–∞");
                                return 0;
                            }
                            return prevTime - 1;
                        });
                    }, 1000); // –£–º–µ–Ω—å—à–∞–µ–º –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
                } else {
                    clearInterval(gameLoopIntervalRef.current);
                }
                return () => clearInterval(gameLoopIntervalRef.current);
            }, [gameState, GAME_STATE.PLAYING, endGame]);

            // –¢–∞–π–º–µ—Ä –∫—É–ª–¥–∞—É–Ω–∞ –ø—Ä—ã–∂–∫–∞
            useEffect(() => {
                if (jumpCooldown > 0) {
                    const timer = setInterval(() => {
                        setJumpCooldown(prev => {
                            if (prev <= 0.1) { // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –º–∞–ª–µ–Ω—å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, —á—Ç–æ–±—ã –æ—á–∏—Å—Ç–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª
                                clearInterval(timer);
                                return 0;
                            }
                            return prev - 0.1;
                        });
                    }, 100);
                    return () => clearInterval(timer);
                }
            }, [jumpCooldown]);

            // –°–ø–∞–≤–Ω —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤
            useEffect(() => {
                if (gameState === GAME_STATE.PLAYING) {
                    phoneSpawnIntervalRef.current = setInterval(spawnPhone, phoneSpawnInterval);
                } else {
                    clearInterval(phoneSpawnIntervalRef.current);
                }
                return () => clearInterval(phoneSpawnIntervalRef.current);
            }, [gameState, GAME_STATE.PLAYING, spawnPhone, phoneSpawnInterval]);

            // --- UI Components ---

            // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –°–º–∞–π–ª–∏–∫–∞
            const Emoji = ({ isCurrent }) => (
                <div
                    className={`absolute transition-all duration-300 ease-out transform ${
                        isCurrent ? 'is-current-emoji' : ''
                    }`}
                    style={{
                        width: '40px',
                        height: '40px',
                        borderRadius: '50%',
                        backgroundColor: 'yellow',
                        display: 'flex',
                        justifyContent: 'center',
                        alignItems: 'center',
                        fontSize: '28px',
                        border: '2px solid #333',
                        zIndex: 10,
                    }}
                >
                    üòä
                </div>
            );

            // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¢–µ–ª–µ—Ñ–æ–Ω–∞
            const Phone = ({ id, x, y, isCurrent, onClick }) => (
                <div
                    className={`phone-item rounded-2xl shadow-lg transition-all duration-300 ease-out cursor-pointer flex flex-col items-center justify-center p-2 ${
                        isCurrent ? 'is-current' : 'border-2 border-gray-400 bg-gray-100'
                    }`}
                    style={{
                        left: `${x}%`,
                        top: `${y}%`,
                    }}
                    onClick={() => onClick(id)}
                >
                    <div className="text-xl font-bold mb-2">üì±</div>
                    <div className="text-sm text-gray-700">–¢–µ–ª–µ—Ñ–æ–Ω {id.substring(0, 4)}</div>
                    {isCurrent && <Emoji isCurrent={isCurrent} />}
                    <div className="absolute bottom-2 text-xs text-gray-500">
                        {isCurrent ? '–í—ã –∑–¥–µ—Å—å!' : '–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –ø—Ä—ã–≥–Ω—É—Ç—å'}
                    </div>
                </div>
            );

            return (
                <>
                    {/* Game Header */}
                    <div className="bg-white p-6 rounded-xl shadow-xl mb-6 text-center w-full max-w-md">
                        <h1 className="text-4xl font-bold text-gray-800 mb-2">Emoji Jump!</h1>
                        <p className="text-lg text-gray-600">–ü—Ä—ã–≥–∞–π—Ç–µ –º–µ–∂–¥—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞–º–∏, –∏–∑–±–µ–≥–∞–π—Ç–µ –±—ã—Ç—å –ø–æ–π–º–∞–Ω–Ω—ã–º!</p>
                        <div className="mt-4 text-2xl font-semibold text-blue-600">–°—á–µ—Ç: {score}</div>
                        {gameState === GAME_STATE.PLAYING && (
                            <div className="text-xl text-red-500 mt-2">–í—Ä–µ–º—è –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø—Ä—ã–∂–∫–∞/–∫–æ–Ω—Ü–∞ –∏–≥—Ä—ã: {timeToNextPhone}—Å</div>
                        )}
                        <p className="text-md text-gray-700 mt-2">{message}</p>
                    </div>

                    {/* Game Area */}
                    <div className="phone-container">
                        {phones.map(phone => (
                            <Phone
                                key={phone.id}
                                id={phone.id}
                                x={phone.x}
                                y={phone.y}
                                isCurrent={phone.id === currentPhoneId}
                                onClick={handleJump}
                            />
                        ))}
                    </div>

                    {/* Game Controls / Status */}
                    <div className="mt-8">
                        {gameState === GAME_STATE.START && (
                            <button
                                onClick={startGame}
                                className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105"
                            >
                                –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
                            </button>
                        )}
                        {gameState === GAME_STATE.GAME_OVER && (
                            <button
                                onClick={startGame}
                                className="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105"
                            >
                                –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞
                            </button>
                        )}
                        {gameState === GAME_STATE.PLAYING && jumpCooldown > 0 && (
                            <div className="text-lg text-gray-700 mt-4">–ö—É–ª–¥–∞—É–Ω –ø—Ä—ã–∂–∫–∞: {jumpCooldown.toFixed(1)}—Å</div>
                        )}
                    </div>
                </>
            );
        };

        // Mount the React app
        const domNode = document.getElementById('game-root');
        const root = createRoot(domNode);
        root.render(<App />);
    </script>
</body>
</html>
